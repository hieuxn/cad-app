<div class="scrollable-container">
  <form [formGroup]="tableForm">
    <table mat-table [dataSource]="rows.controls" class="mat-elevation-z8 custom-mat-table" formArrayName="rows">

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef> Name </th>
        <td mat-cell *matCellDef="let element; let i = index" [formGroupName]="i"> {{element.get('name').value |
          titleSpacing}} </td>
      </ng-container>

      <ng-container matColumnDef="value">
        <th mat-header-cell *matHeaderCellDef> Value </th>
        <td mat-cell *matCellDef="let element; let i = index" [formGroupName]="i">
          <ng-container *ngIf="editingIndex === i">
            <input *ngIf="element.get('name').value === 'color'" [(colorPicker)]="element.get('value').value"
              [style.background]="element.get('value').value"
              (colorPickerChange)="element.get('value').setValue($event);" (colorPickerClose)="colorPickerChange(i)"
              (keydown)="handleKeydown($event, i)" appAutofocus>

            <input *ngIf="element.get('name').value !== 'color'" #input matInput formControlName="value"
              (keydown)="handleKeydown($event, i)" appAutofocus (blur)="cancelEdit(-1)">
          </ng-container>
          <div *ngIf="editingIndex !== i" (dblclick)="startEdit(i, element.get('value').value)">
            {{element.get('value').value}}
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['name', 'value']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['name', 'value'];"></tr>
    </table>
  </form>
</div>